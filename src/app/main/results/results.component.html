<h1 *ngIf="!dialog" style="display: flex; justify-content: space-between;">
  <app-help-widget tooltipKey="helpResults" textKey="Results" dialogKey="helpDialogResults"></app-help-widget>
  <span>
    <mat-icon *ngIf="proposalService.selectedProposalSetType === 'custom'" class="inline icon-button" (click)="openCopyDialog()">share</mat-icon>
    <mat-icon class="inline icon-button" (click)="openParametersDialog()">settings</mat-icon>
  </span>
</h1>

<div *ngIf="results$ | async; let results">
  <!-- <mat-card class="result-section">
    <h2>{{ 'Russian economy impact' | translate }}</h2>

    <div class="result-section-with-image" ngClass.lt-sm="result-section-with-image-lt-md">
      <img class="result-section-image" [src]="results.image" />

      <div class="result-section-targets">
        <h3 class="result-section-collapsed">
          <span class="collapsed-header">
            <mat-icon class="inline">request_quote</mat-icon>
            {{ 'Yearly transfer' | translate }}
          </span>

          <span class="collapsed-header-summary" [class.color-accent]="results.totalMoneyToRussia === 0"> €&nbsp;{{ results.totalMoneyToRussia | number }}</span>
        </h3>

        <h3 class="result-section-collapsed">
          <span class="collapsed-header">
            <mat-icon class="inline">propane</mat-icon>
            {{ 'Gas imported' | translate }}
          </span>

          <mat-progress-bar class="progress" mode="determinate"
            [color]="results.rgTarget.color"
            [value]="results.rgTarget.percentage">
          </mat-progress-bar>
        </h3>

        <h3 class="result-section-collapsed">
          <span class="collapsed-header">
            <mat-icon class="inline">oil_barrel</mat-icon>
            {{ 'Oil imported' | translate }}
          </span>

          <mat-progress-bar class="progress" mode="determinate"
            [color]="results.roTarget.color"
            [value]="results.roTarget.percentage">
          </mat-progress-bar>
        </h3>
      </div>
    </div>
  </mat-card> -->

  <mat-card class="result-section">
    <h3 class="result-section-collapsed">
      <span class="collapsed-header">
        <!-- <span class="icon-with-icon-badge"> -->
          <mat-icon class="inline">cloud_download</mat-icon>&nbsp;<app-help-widget tooltipKey="helpLegalReductionTarget" textKey="Legal reduction" dialogKey="helpDialogLegalReductionTarget"></app-help-widget>
          <!-- <mat-icon class="inline icon-badge">gavel</mat-icon> -->
        <!-- </span> -->

      </span>

      <app-result-progress [target]="results.legalGhgTarget"></app-result-progress>
    </h3>
  </mat-card>

  <mat-card class="result-section">
    <h2>{{ 'European targets' | translate }}</h2>
    <h3 class="result-section-collapsed">
      <span class="collapsed-header">
        <mat-icon class="inline">cloud_download</mat-icon>&nbsp;<app-help-widget
          tooltipKey="helpCo2reductionTarget" textKey="GHG reduction" dialogKey="helpDialogCo2reductionTarget"></app-help-widget>
      </span>

      <app-result-progress [target]="results.euGhgTarget"></app-result-progress>
    </h3>

    <h3 class="result-section-collapsed">
      <span class="collapsed-header">
        <mat-icon class="inline">energy_savings_leaf</mat-icon>
        {{ 'Energy efficiency' | translate }}
      </span>

      <app-result-progress [target]="results.euEeTarget"></app-result-progress>
    </h3>

    <h3 class="result-section-collapsed">
      <span class="collapsed-header">
        <mat-icon class="inline">solar_power</mat-icon>
        {{ 'Renewable energy' | translate }}
      </span>

      <app-result-progress [target]="results.euReTarget"></app-result-progress>
    </h3>
  </mat-card>

  <mat-card class="result-section">
    <h3 *ngIf="expandedTotalCost">
      <mat-icon class="inline">sell</mat-icon> {{ 'Total cost' | translate }}
      <a [routerLink]="" class="unstyled-link pull-right" (click)="toggleTotalCost()" *ngIf="!this.dialog">
        <mat-icon class="inline">
          {{ expandedTotalCost ? 'expand_more' : 'chevron_left' }}
        </mat-icon>
      </a>
    </h3>

    <h3 *ngIf="!expandedTotalCost" class="result-section-collapsed">
      <span class="collapsed-header">
        <mat-icon class="inline">sell</mat-icon>
        {{ (results.totalCostIncludingTax < 0 ? 'Total profit' : 'Total cost') | translate }}
      </span>

      <span class="collapsed-header-summary" [class.color-accent]="results.totalCostIncludingTax < 0">
        €&nbsp;{{ (results.totalCostIncludingTax < 0 ? -results.totalCostIncludingTax : results.totalCostIncludingTax) | number }}
      </span>

      <a [routerLink]="" class="unstyled-link collapsed-expand" (click)="toggleTotalCost()">
        <mat-icon class="inline">
          {{ expandedTotalCost ? 'expand_more' : 'chevron_left' }}
        </mat-icon>
      </a>
    </h3>

    <div *ngIf="expandedTotalCost">
      <div class="calc-table" *ngIf="parametersService.parameters$ | async; let parameters">
        <div class="calc-line">
          <span class="calc-line-header">{{ 'Total measures cost' | translate }}</span>
          <span class="calc-line-number">€&nbsp;{{ results.totalMeasurementCost | number }}</span>
        </div>
        <div class="calc-line">
          <span class="calc-line-header"><app-help-widget [tooltipKey]="(results.totalEuGhgTax > 0 ? 'helpCarbonTax' : 'helpCarbonIncome')" [tooltipParameters]="{ carbonTax: parameters.pricePerTonGhg | number }"
            [textKey]="results.totalEuGhgTax > 0 ? 'Emissions trading cost' : 'Emissions trading profit'"></app-help-widget></span>
          <span class="calc-line-number" [class.color-accent]="results.totalEuGhgTax < 0"> €&nbsp;{{ (results.totalEuGhgTax > 0 ? results.totalEuGhgTax : -results.totalEuGhgTax) | number }}</span>
        </div>
        <div class="calc-line">
          <span class="calc-line-header"><app-help-widget tooltipKey="helpLegalPenalty" textKey="Legal penalty" [tooltipParameters]="{ legalPenalty: parameters.monthlyLegalPenalty| number }"></app-help-widget></span>
          <span class="calc-line-number" [class.color-accent]="results.totalLegalPenalty === 0"> €&nbsp;{{ results.totalLegalPenalty | number }}</span>
        </div>
        <div class="calc-line total-line">
          <span class="calc-line-header">{{ 'Including emission trading' | translate }}</span>
          <span class="calc-line-number" [class.color-accent]="results.totalCostIncludingTax < 0"> €&nbsp;{{ (results.totalCostIncludingTax < 0 ? -results.totalCostIncludingTax : results.totalCostIncludingTax) | number }}</span>
        </div>
      </div>
      <p *ngIf="results.totalCostIncludingTax > 0" style="margin-top: 12px">
        <a [href]="" (click)="showCostComparisonDialog()">{{ 'Find out what could be done with this budget instead' | translate }}</a>
      </p>
    </div>
  </mat-card>

  <mat-card class="result-section">
    <h3 *ngIf="expandedTotalImpact">
      <mat-icon class="inline">public</mat-icon> {{ 'Total impact' | translate }}
      <a [routerLink]="" class="unstyled-link pull-right" (click)="toggleTotalImpact()" *ngIf="!this.dialog">
        <mat-icon class="inline">
          {{ expandedTotalImpact ? 'expand_more' : 'chevron_left' }}
        </mat-icon>
      </a>
    </h3>

    <h3 *ngIf="!expandedTotalImpact" class="result-section-collapsed">
      <span class="collapsed-header">
        <mat-icon class="inline">public</mat-icon>
        {{ 'Total impact' | translate }}
      </span>

      <span class="collapsed-header-summary">
        <span *ngFor="let impactItem of results.totalImpact">
          <mat-icon class="inline icon-list-item" [class]="impactItem.class" matTooltip="{{ enums.ImpactDomain[impactItem.domain] | translate }}">{{ impactItem.getImpactDomainIcon() }}</mat-icon>
        </span>
      </span>

      <a [routerLink]="" class="unstyled-link collapsed-expand" (click)="toggleTotalImpact()">
        <mat-icon class="inline">
          {{ expandedTotalImpact ? 'expand_more' : 'chevron_left' }}
        </mat-icon>
      </a>
    </h3>

    <div *ngIf="expandedTotalImpact">
      <div *ngFor="let impactItem of results.totalImpact">
        <mat-icon class="inline icon-list-item" [class]="impactItem.class" matTooltip="{{ enums.ImpactDomain[impactItem.domain] | translate }}">{{ impactItem.getImpactDomainIcon() }}</mat-icon>
        {{ enums.ImpactDomain[impactItem.domain] | translate }}: {{ displayImpact(impactItem.amount) }}
      </div>
    </div>
  </mat-card>
</div>

<button fxHide.lt-md mat-raised-button color="primary" (click)="submit()" class="submit-button-lg">{{ 'Publish results' | translate }}</button>

<button fxHide.gt-sm mat-raised-button color="primary" (click)="submit()" style="margin-bottom: 56px;">{{ 'Publish results' | translate }}</button>
