<form #proposalForm="ngForm" class="responsive-page-container column-form">
  <!-- Load existing -->
  <mat-form-field appearance="fill" style="flex: 1">
    <mat-label>Selected proposal</mat-label>
    <mat-select name="selectedProposal" #selectedProposal (selectionChange)="load($event.value)">
      <mat-optgroup *ngFor="let region of allRegions">{{ region | translate }}
        <mat-option *ngFor="let proposal of allProposals[region]" [value]="proposal">
          {{ 'proposals.' + proposal.slugEn + '.title' | translate }}
        </mat-option>
      </mat-optgroup>
    </mat-select>
  </mat-form-field>

  <!-- ID (Read-only) -->
  <mat-form-field appearance="fill">
    <mat-label>ID</mat-label>
    <input matInput type="text" name="id" [(ngModel)]="proposal.id" readonly>
  </mat-form-field>

  <div class="row-form">
    <!-- Policy Level (Dropdown) -->
    <mat-form-field appearance="fill">
      <mat-label>Policy Level</mat-label>
      <mat-select name="policyLevel" [(ngModel)]="proposal.policyLevel">
        <mat-option *ngFor="let level of policyLevels" [value]="level">{{ enums.PolicyLevel[level] | translate }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Sector (Dropdown) -->
    <mat-form-field appearance="fill">
      <mat-label>Sector</mat-label>
      <mat-select name="sector" [(ngModel)]="proposal.sector">
        <mat-option *ngFor="let sector of sectors" [value]="sector">{{ enums.Sector[sector] | translate }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Origin (Dropdown) -->
    <mat-form-field appearance="fill">
      <mat-label>Origin</mat-label>
      <mat-select name="origin" [(ngModel)]="proposal.origin">
        <mat-option *ngFor="let origin of proposalOrigins" [value]="origin">{{ enums.ProposalOrigin[origin] | translate }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="row-form">
    <!-- Committed (Checkbox) -->
    <mat-checkbox name="committed" [(ngModel)]="proposal.committed">Committed</mat-checkbox>

    <!-- ETS (Checkbox) -->
    <mat-checkbox name="ets" [(ngModel)]="proposal.ets">ETS</mat-checkbox>

    <div></div>
  </div>

  <!-- Slug NL -->
  <mat-form-field appearance="fill">
    <mat-label>Slug NL</mat-label>
    <input matInput type="text" name="slugNl" [(ngModel)]="proposal.slugNl">
  </mat-form-field>

  <!-- Slug EN -->
  <mat-form-field appearance="fill">
    <mat-label>Slug EN</mat-label>
    <input matInput type="text" name="slugEn" [(ngModel)]="proposal.slugEn">
  </mat-form-field>

  <!-- Slug FR -->
  <mat-form-field appearance="fill">
    <mat-label>Slug FR</mat-label>
    <input matInput type="text" name="slugFr" [(ngModel)]="proposal.slugFr">
  </mat-form-field>

  <!-- Picture Thumbnail (Input or File Upload) -->
  <mat-form-field appearance="fill">
    <mat-label>Picture Thumbnail</mat-label>
    <input matInput type="text" name="pictureThumb" [(ngModel)]="proposal.pictureThumb">
  </mat-form-field>

  <!-- Icon (Input or File Upload) -->
  <mat-form-field appearance="fill">
    <mat-label>Icon</mat-label>
    <input matInput type="text" name="icon" [(ngModel)]="proposal.icon">
  </mat-form-field>

  <div *ngFor="let variant of proposal.variants; let variantIndex = index" class="column-form subform">
    <h3>Variant {{variantIndex + 1}}</h3>

    <!-- Ambition Level -->
    <mat-form-field appearance="fill">
      <mat-label>Ambition Level</mat-label>
      <input matInput type="number" name="ambitionLevel{{variantIndex}}" [(ngModel)]="variant.ambitionLevel">
    </mat-form-field>

    <div class="row-form">
      <!-- Initial Cost -->
      <mat-form-field appearance="fill">
        <mat-label>Initial Cost</mat-label>
        <input matInput type="number" name="costInitial{{variantIndex}}" [(ngModel)]="variant.costInitial">
      </mat-form-field>

      <!-- Cost Per Year Fixed -->
      <mat-form-field appearance="fill">
        <mat-label>Cost Per Year Fixed</mat-label>
        <input matInput type="number" name="costPerYearFixed{{variantIndex}}" [(ngModel)]="variant.costPerYearFixed">
      </mat-form-field>
    </div>

    <div class="variable-form">
      <!-- Cost Per Year Variable -->
      <mat-form-field *ngFor="let yearCost of getCostPerYearVariableKeys(variant); let yearIndex = index" appearance="fill">
        <mat-label>Cost for Year {{yearCost}}</mat-label>
        <input matInput type="number" name="costPerYearVariable{{variantIndex}}_{{yearIndex}}" [(ngModel)]="variant.costPerYearVariable![yearCost]">
      </mat-form-field>
    </div>

    <!-- Add Year Cost Button -->
    <button mat-raised-button type="button" (click)="addYearCost(variant)">Add Year Cost</button>

    <ng-container *ngIf="proposal.policyLevel !== enums.PolicyLevel.federal">
      <!-- Targets -->
      <div *ngFor="let target of variant.targets; let targetIndex = index" class="card subform">
        <div class="row-form">
          <mat-form-field appearance="fill">
            <mat-label>Target Type</mat-label>
            <mat-select name="targetType{{variantIndex}}_{{targetIndex}}" [(ngModel)]="target.type">
              <mat-option *ngFor="let targetType of targetTypes" [value]="targetType">{{ enums.TargetType[targetType] | translate }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Target Amount</mat-label>
            <input matInput type="number" name="targetAmount{{variantIndex}}_{{targetIndex}}" [(ngModel)]="target.amount">
          </mat-form-field>
        </div>
      </div>

      <!-- Add Target Button -->
      <button mat-raised-button type="button" (click)="addTarget(variant)">Add Target</button>
    </ng-container>

    <ng-container *ngIf="proposal.policyLevel === enums.PolicyLevel.federal">
      <!-- Regional Targets -->
      <div *ngFor="let region of allContexts; let regionIndex = index" class="subform">
        <h4>Regional Targets for {{region}}</h4>
        <div *ngFor="let target of getRegionalTargets(variant, region); let targetIndex = index" class="row-form">
          <mat-form-field appearance="fill">
            <mat-label>Target Type</mat-label>
            <mat-select name="regionalTargetType{{variantIndex}}_{{regionIndex}}_{{targetIndex}}" [(ngModel)]="target.type">
              <mat-option *ngFor="let targetType of targetTypes" [value]="targetType">{{ enums.TargetType[targetType] | translate }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Target Amount</mat-label>
            <input matInput type="number" name="regionalTargetAmount{{variantIndex}}_{{regionIndex}}_{{targetIndex}}" [(ngModel)]="target.amount">
          </mat-form-field>
        </div>

        <!-- Add Regional Target Button -->
        <button mat-raised-button type="button" (click)="addRegionalTarget(variant, region)">Add Regional Target for {{region}}</button>
      </div>
    </ng-container>

    <!-- Impacts -->
    <div *ngFor="let impact of variant.impacts; let impactIndex = index">
      <div class="row-form">
        <mat-form-field appearance="fill">
          <mat-label>Impact Domain</mat-label>
          <mat-select name="impactDomain{{variantIndex}}_{{impactIndex}}" [(ngModel)]="impact.domain">
            <mat-option *ngFor="let impactDomain of impactDomains" [value]="impactDomain">{{ enums.ImpactDomain[impactDomain] | translate }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Impact Amount</mat-label>
          <mat-select name="impactAmount{{variantIndex}}_{{impactIndex}}" [(ngModel)]="impact.amount">
            <mat-option *ngFor="let impactAmount of impactAmounts" [value]="impactAmount">{{ enums.ImpactAmount[impactAmount] | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Add Impact Button -->
    <button mat-raised-button type="button" (click)="addImpact(variant)">Add Impact</button>

    <!-- Remove Variant Button -->
    <button mat-raised-button type="button" (click)="removeVariant(variantIndex)">Remove Variant</button>
  </div>

  <!-- Add Variant Button -->
  <button mat-raised-button type="button" (click)="addVariant()">Add Variant</button>

  <!-- Submit Button -->
  <button mat-raised-button color="primary" type="submit" [disabled]="!proposalForm.valid">Submit</button>
</form>
